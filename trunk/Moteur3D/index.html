<!DOCTYPE html>
<html>
    <head>
        <title id="title">3DWIGS</title>
    </head>
	
	<div>
		<div style="width:900px;margin:auto;position:relative" id="container">
			<canvas id="canvas" width="900" height="500"></canvas>
			<div id="framerate" style="position:absolute; left: 750px; top: 20px; background-color: #000; opacity: 0.5;height: 30px; width: 130px; border-radius: 5px;	-moz-border-radius5px;-webkit-border-radius:5px;border: 1px solid #fff;">
				<div id="debug" style="padding: 5px"></div>
			</div>
			<div style="padding: 5px;position:absolute; left: 20px; top: 370px; background-color: #000; opacity: 0.5;height: 100px; width: 400px; border-radius: 5px;	-moz-border-radius5px;-webkit-border-radius:5px;border: 1px solid #fff;">
				<h2 style="margin:0;padding:0;padding-bottom: 5px;font-size: 20px">Demo du moteur3d de 3DWIGS</h2>
				<p style="margin:0;padding:0;padding-bottom: 5px;">Le jeu du lapin </p>
			</div>
		</div>
	</div>
	
    <body>
		<style>
			body{background-color: #000;color: #fff;font-family:arial}
		</style>
        <script type="text/javascript" src="js/moteur_allJS.php"></script>
               
		<script type="text/javascript">
			
			M3D.MOTEUR.initialisation("level.xml", 'canvas');
			M3D.MOTEUR.initPhysicalForce(0.01);
			
			var depla = [0,0,0];
			var depla2 = [0,0,0];
			var tire = false;
			var come_back_to_life = false;
			
			panelControl = function(){			
				if(KEY_Z){depla[0] += 0.01; law(M3D.MOTEUR.translate("voiture",depla), "voiture");}
				else if(depla[0]>=0) depla[0] -= 0.01;
				
				if(KEY_S){depla[0] += -0.01; law(M3D.MOTEUR.translate("voiture",depla), "voiture");} 
				else if(depla[0]<=0) depla[0] += 0.01;
				
				if(KEY_Q){depla[2] += 0.01; law(M3D.MOTEUR.translate("voiture",depla), "voiture");} 		
				else if(depla[2]>=0) depla[2] -= 0.01;
				
				if(KEY_D){depla[2] += -0.01; law(M3D.MOTEUR.translate("voiture",depla), "voiture");} 
				else if(depla[2]<=0) depla[2] += 0.01;
				
				if(KEY_P){ depla[1] += 0.01; law(M3D.MOTEUR.translate("voiture",depla), "voiture");}
				else if(depla[1]>=0) depla[1] -= 0.01;
				
				if(KEY_M){ depla[1] += -0.1; law(M3D.MOTEUR.translate("voiture",depla), "voiture");} 
				else if(depla[1]<=0) depla[1] += 0.01;
				
				if(KEY_SPACE) tire = true;
			}
			
			
			panelAction = function(){
				if(tire){
					depla2[2] +=0.01; 
					law(M3D.MOTEUR.translate("missile",depla2),"missile");
					//M3D.MOTEUR.trajectory("missile",0.01,[0,1,0]);
					}
				if(come_back_to_life){M3D.MOTEUR.addObject("lapin", "dae/lapin.dae", [15,-0.5,0,0,0,0,1]); come_back_to_life = false;}
			}
			
			
			law = function(tab, id){
				if(id = "voiture"){
					if(tab.length != 0){
						if(M3D.MOTEUR.searchTarget(tab,"lapin")){
							tire = false; depla2 = [0,0,0];
							M3D.MOTEUR.removeObject("lapin");
							M3D.MOTEUR.removeObject("missile");
							M3D.MOTEUR.addObjectIn("missile","dae/missile.dae",[0,0,0,0,0,0,0.5],"arme");
							come_back_to_life = true;
						}
					}
				} else if(id == "missile"){
					if(tab.length != 0){
						if(M3D.MOTEUR.searchTarget(tab,"lapin")){
							tire = false; depla2 = [0,0,0];
							M3D.MOTEUR.removeObject("lapin");
							M3D.MOTEUR.removeObject("missile");
							M3D.MOTEUR.addObjectIn("missile","missile.dae",[0,0,0,0,0,0,0.5],"arme");
							come_back_to_life = true;
						}
					}
				}
			}
			
			render = function(){
				panelControl();
				panelAction();
				M3D.MOTEUR.render();
			}
			
			
			window.addEventListener('load', function () {
				window.document.onkeydown = M3D.MOTEUR.checkKeyDown;
				window.document.onkeyup = M3D.MOTEUR.checkKeyUp;
			}, false);
			
			setInterval(render,1);
		</script>
    </body>
</html>